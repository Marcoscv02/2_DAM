[[3. MANEJO DE EXCEPCIONES EN SQL]]
# **1.Â Interfaz ResultSet**


>ğŸ’¡LaÂ [interfaz ResultSet](https://docs.oracle.com/en/java/javase/21/docs/api/java.sql/java/sql/ResultSet.html)Â dispone de mÃ©todos para recuperar y manipular los resultados de consultas ejecutadas.


## **1.1 CaracterÃ­sticas principales**:

### **Tipos de cursor**:



ğŸ—¯ï¸El primer argumento de los mÃ©todos Â `createStatement`,Â  `prepareStatement`Â  y Â `prepareCall`Â  define el tipo de ResultSet


- `**TYPE_FORWARD_ONLY**`: Cursor avanza solo hacia adelante (desde antes de la primera fila hasta despuÃ©s de la Ãºltima).
- **`TYPE_SCROLL_INSENSITIVE`**: Cursor puede moverse en ambas direcciones y hacÃ­a una posiciÃ³n absoluta, pero no refleja cambios en la base de datos.
- **`TYPE_SCROLL_SENSITIVE`**: posee las mismas caracterÃ­sticas que el anterior, pero en este caso si que refleja cambios en la base de datos.

```java
con.getMetaData().supportsResultSetType(ResultSet.TYPE_SCROLL_INSENSITIVE); 
System.out.println("Soporta TYPE_SCROLL_INSENSITIVE");
```

### **Concurrencia (Actualizable o no)**:

<aside> ğŸ—¯ï¸

El segundo argumento de los mÃ©todos Â `createStatement`,Â  `prepareStatement`Â  y Â `prepareCall`Â  es el tipo de concurrencia, que determina que **nivel de funcionalidad de actualizaciÃ³n se admite**

</aside>

- **`CONCUR_READ_ONLY`**: Solo lectura (predeterminado).
- **`CONCUR_UPDATABLE`**: Permite actualizar datos.

> _No todos los controladores JDBC admiten concurrenncia_

```java
con.getMetaData().supportsResultSetConcurrency(ResultSet.TYPE_SCROLL_INSENSITIVE,
                    ResultSet.CONCUR_UPDATABLE)
```

### **RetenciÃ³n del cursor**:



>ğŸ—¯ï¸Sirve para configurar el cierre (o no cierre del objeto ResultSet) cuando se llama al mÃ©todo Commit



- **`HOLD_CURSORS_OVER_COMMIT`**: Cursor permanece abierto trasÂ **`commit`**.
- **`CLOSE_CURSORS_AT_COMMIT`**: Cursor se cierra trasÂ **`commit`**.

---

# **2.Â RecuperaciÃ³n de Valores**

- **MÃ©todos principales**:
    - **`getInt`**,Â **`getString`**,Â **`getDate`**, etc., para recuperar valores desde la fila actual.
- **Acceso a columnas**:
    - Por Ã­ndice (mÃ¡s eficiente, columnas numeradas desde 1).
    - Por nombre o alias (menos eficiente, pero Ãºtil para columnas nombradas explÃ­citamente en la consulta).
- **Ejemplo**:

```java
while (rs.next()) {
    String nombreCafe = rs.getString(1);
    int idProveedor = rs.getInt(2);
    // Otros valores...
}
```

---

# **3.Â Moviendo el Cursor**

- **Posicionamiento del cursor**:
    - **`next`**: Avanza una fila.
    - **`previous`**: Retrocede una fila.
    - **`first`**: Primera fila.
    - **`last`**: Ãšltima fila.
    - **`beforeFirst`**: Antes de la primera fila.
    - **`afterLast`**: DespuÃ©s de la Ãºltima fila.
    - **`absolute(n)`**: Fila n especÃ­fica.
    - **`relative(n)`**: Desplazamiento relativo a la posiciÃ³n actual.
- **Limitaciones**:
    - Tipo predeterminado (**`TYPE_FORWARD_ONLY`**) no admite movimientos, salvoÂ **`next`**.

---

# **4.Â ActualizaciÃ³n de Filas**

- **Requisitos**:
    - ElÂ **`ResultSet`**Â debe serÂ **`CONCUR_UPDATABLE`**Â y permitir desplazamiento (**`TYPE_SCROLL_SENSITIVE`**Â oÂ **`TYPE_SCROLL_INSENSITIVE`**).
- **MÃ©todos de actualizaciÃ³n**:
    - Ejemplo:Â **`updateInt`**,Â **`updateFloat`**,Â **`updateString`**, etc.
    - Debe llamarse aÂ **`updateRow`**Â para hacer efectivos los cambios en la base de datos.
- **Ejemplo**:

```java
ResultSet uprs = stmt.executeQuery("SELECT * FROM Cafe");
while (uprs.next()) {
    float precio = uprs.getFloat("precio");
    uprs.updateFloat("precio", precio * porcentaje);
    uprs.updateRow();
}
```

---

# **5.Â Uso de Objetos Statement**

- UnÂ **`ResultSet`**Â se puede crear usando:
    - **`Statement`**
    - **`PreparedStatement`**
    - **`CallableStatement`**
    - **`RowSet`**

# **6.Â Notas Adicionales**

- **Compatibilidad**:
    - No todos los tipos deÂ **`ResultSet`**Â o niveles de concurrencia son soportados por todos los controladores JDBC.
    - MÃ©todos comoÂ **`DatabaseMetaData.supportsResultSetType`**Â oÂ **`supportsResultSetConcurrency`**Â verifican compatibilidad.
- **Manejo de Excepciones**: Siempre envolver las operaciones con bloquesÂ **`try-catch`**.

---

### **CÃ³digo de Ejemplo:Â Mostrar una Tabla**

```java
public static void showCafes(Connection con) throws SQLException {
    String query = "SELECT nome, idProveedor, precio, ventas, total FROM Cafe";
    try (Statement stmt = con.createStatement()) {
        ResultSet rs = stmt.executeQuery(query);
        while (rs.next()) {
            System.out.println(rs.getString("nome") + ", " + rs.getInt("idProveedor") +
                ", " + rs.getFloat("precio") + ", " + rs.getInt("ventas") +
                ", " + rs.getInt("total"));
        }
    } catch (SQLException e) {
        e.printStackTrace();
    }
}
```

---

### **CÃ³digo de Ejemplo:Â Actualizar Precios**

```java
public void actualizarPrecios(float porcentaje) throws SQLException {
    try (Statement stmt = con.createStatement(
        ResultSet.TYPE_SCROLL_SENSITIVE, ResultSet.CONCUR_UPDATABLE)) {
        ResultSet rs = stmt.executeQuery("SELECT * FROM Cafe");
        while (rs.next()) {
            float precioActual = rs.getFloat("precio");
            rs.updateFloat("precio", precioActual * porcentaje);
            rs.updateRow();
        }
    } catch (SQLException e) {
        e.printStackTrace();
    }
}
```